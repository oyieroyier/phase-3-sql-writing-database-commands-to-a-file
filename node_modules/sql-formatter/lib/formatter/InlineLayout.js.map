{"version":3,"file":"InlineLayout.js","names":["InlineLayout","expressionWidth","Indentation","items","forEach","item","addToLength","length","InlineLayoutError","trailingSpace","WS","MANDATORY_NEWLINE","NEWLINE","INDENT","SINGLE_INDENT","SPACE","NO_NEWLINE","NO_SPACE","Layout","Error"],"sources":["../../src/formatter/InlineLayout.ts"],"sourcesContent":["// eslint-disable-next-line max-classes-per-file\nimport Indentation from './Indentation';\nimport Layout, { WS } from './Layout';\n\n/**\n * Like Layout, but only formats single-line expressions.\n *\n * Throws InlineLayoutError:\n * - when encountering a newline\n * - when exceeding configured expressionWidth\n */\nexport default class InlineLayout extends Layout {\n  private length = 0;\n  // Keeps track of the trailing whitespace,\n  // so that we can decrease length when encountering WS.NO_SPACE,\n  // but only when there actually is a space to remove.\n  private trailingSpace = false;\n\n  constructor(private expressionWidth: number) {\n    super(new Indentation('')); // no indentation in inline layout\n  }\n\n  public add(...items: (WS | string)[]) {\n    items.forEach(item => this.addToLength(item));\n    if (this.length > this.expressionWidth) {\n      // We have exceeded the allowable width\n      throw new InlineLayoutError();\n    }\n    super.add(...items);\n  }\n\n  private addToLength(item: WS | string) {\n    if (typeof item === 'string') {\n      this.length += item.length;\n      this.trailingSpace = false;\n    } else if (item === WS.MANDATORY_NEWLINE || item === WS.NEWLINE) {\n      // newlines not allowed within inline block\n      throw new InlineLayoutError();\n    } else if (item === WS.INDENT || item === WS.SINGLE_INDENT || item === WS.SPACE) {\n      if (!this.trailingSpace) {\n        this.length++;\n        this.trailingSpace = true;\n      }\n    } else if (item === WS.NO_NEWLINE || item === WS.NO_SPACE) {\n      if (this.trailingSpace) {\n        this.trailingSpace = false;\n        this.length--;\n      }\n    }\n  }\n}\n\n/**\n * Thrown when block of SQL can't be formatted as a single line.\n */\nexport class InlineLayoutError extends Error {}\n"],"mappings":";;;;;;;;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;IACqBA,Y;;;;;EAEnB;EACA;EACA;EAGA,sBAAoBC,eAApB,EAA6C;IAAA;;IAAA;;IAC3C,0BAAM,IAAIC,uBAAJ,CAAgB,EAAhB,CAAN,EAD2C,CACf;;IADe,MAAzBD,eAAyB,GAAzBA,eAAyB;;IAAA,yDAN5B,CAM4B;;IAAA,gEAFrB,KAEqB;;IAAA;EAE5C;;;;WAED,eAAsC;MAAA;MAAA;;MAAA,kCAAxBE,KAAwB;QAAxBA,KAAwB;MAAA;;MACpCA,KAAK,CAACC,OAAN,CAAc,UAAAC,IAAI;QAAA,OAAI,MAAI,CAACC,WAAL,CAAiBD,IAAjB,CAAJ;MAAA,CAAlB;;MACA,IAAI,KAAKE,MAAL,GAAc,KAAKN,eAAvB,EAAwC;QACtC;QACA,MAAM,IAAIO,iBAAJ,EAAN;MACD;;MACD,qGAAaL,KAAb;IACD;;;WAED,qBAAoBE,IAApB,EAAuC;MACrC,IAAI,OAAOA,IAAP,KAAgB,QAApB,EAA8B;QAC5B,KAAKE,MAAL,IAAeF,IAAI,CAACE,MAApB;QACA,KAAKE,aAAL,GAAqB,KAArB;MACD,CAHD,MAGO,IAAIJ,IAAI,KAAKK,WAAA,CAAGC,iBAAZ,IAAiCN,IAAI,KAAKK,WAAA,CAAGE,OAAjD,EAA0D;QAC/D;QACA,MAAM,IAAIJ,iBAAJ,EAAN;MACD,CAHM,MAGA,IAAIH,IAAI,KAAKK,WAAA,CAAGG,MAAZ,IAAsBR,IAAI,KAAKK,WAAA,CAAGI,aAAlC,IAAmDT,IAAI,KAAKK,WAAA,CAAGK,KAAnE,EAA0E;QAC/E,IAAI,CAAC,KAAKN,aAAV,EAAyB;UACvB,KAAKF,MAAL;UACA,KAAKE,aAAL,GAAqB,IAArB;QACD;MACF,CALM,MAKA,IAAIJ,IAAI,KAAKK,WAAA,CAAGM,UAAZ,IAA0BX,IAAI,KAAKK,WAAA,CAAGO,QAA1C,EAAoD;QACzD,IAAI,KAAKR,aAAT,EAAwB;UACtB,KAAKA,aAAL,GAAqB,KAArB;UACA,KAAKF,MAAL;QACD;MACF;IACF;;;;EAtCuCW,mB;AAyC1C;AACA;AACA;;;;;IACaV,iB;;;;;;;;;;;;iCAA0BW,K"}