{"version":3,"file":"Layout.js","names":["WS","Layout","indentation","items","item","SPACE","push","NO_SPACE","trimHorizontalWhitespace","NO_NEWLINE","trimWhitespace","NEWLINE","addNewline","MANDATORY_NEWLINE","INDENT","addIndentation","SINGLE_INDENT","isHorizontalWhitespace","last","pop","isRemovableWhitespace","newline","length","i","getLevel","map","itemToString","join","getSingleIndent"],"sources":["../../src/formatter/Layout.ts"],"sourcesContent":["import { last } from 'src/utils';\n\nimport Indentation from './Indentation';\n\n/** Whitespace modifiers to be used with add() method */\nexport enum WS {\n  SPACE, // Adds single space\n  NO_SPACE, // Removes preceding horizontal whitespace (if any)\n  NO_NEWLINE, // Removes all preceding whitespace (whether horizontal or vertical)\n  NEWLINE, // Adds single newline (and removes any preceding whitespace)\n  MANDATORY_NEWLINE, // Adds single newline that can't be removed by NO_NEWLINE\n  INDENT, // Adds indentation (as much as needed for current indentation level)\n  SINGLE_INDENT, // Adds whitespace for single indentation step\n}\n\nexport type LayoutItem = WS.SPACE | WS.SINGLE_INDENT | WS.NEWLINE | WS.MANDATORY_NEWLINE | string;\n\n/**\n * API for constructing SQL string (especially the whitespace part).\n *\n * It hides the internal implementation.\n * Originally it used plain string concatenation, which was expensive.\n * Now it's storing items to array and builds the string only in the end.\n */\nexport default class Layout {\n  private items: LayoutItem[] = [];\n\n  constructor(public indentation: Indentation) {}\n\n  /**\n   * Appends token strings and whitespace modifications to SQL string.\n   */\n  public add(...items: (WS | string)[]) {\n    for (const item of items) {\n      switch (item) {\n        case WS.SPACE:\n          this.items.push(WS.SPACE);\n          break;\n        case WS.NO_SPACE:\n          this.trimHorizontalWhitespace();\n          break;\n        case WS.NO_NEWLINE:\n          this.trimWhitespace();\n          break;\n        case WS.NEWLINE:\n          this.trimHorizontalWhitespace();\n          this.addNewline(WS.NEWLINE);\n          break;\n        case WS.MANDATORY_NEWLINE:\n          this.trimHorizontalWhitespace();\n          this.addNewline(WS.MANDATORY_NEWLINE);\n          break;\n        case WS.INDENT:\n          this.addIndentation();\n          break;\n        case WS.SINGLE_INDENT:\n          this.items.push(WS.SINGLE_INDENT);\n          break;\n        default:\n          this.items.push(item);\n      }\n    }\n  }\n\n  private trimHorizontalWhitespace() {\n    while (isHorizontalWhitespace(last(this.items))) {\n      this.items.pop();\n    }\n  }\n\n  private trimWhitespace() {\n    while (isRemovableWhitespace(last(this.items))) {\n      this.items.pop();\n    }\n  }\n\n  private addNewline(newline: WS.NEWLINE | WS.MANDATORY_NEWLINE) {\n    if (this.items.length > 0) {\n      switch (last(this.items)) {\n        case WS.NEWLINE:\n          this.items.pop();\n          this.items.push(newline);\n          break;\n        case WS.MANDATORY_NEWLINE:\n          // keep as is\n          break;\n        default:\n          this.items.push(newline);\n          break;\n      }\n    }\n  }\n\n  private addIndentation() {\n    for (let i = 0; i < this.indentation.getLevel(); i++) {\n      this.items.push(WS.SINGLE_INDENT);\n    }\n  }\n\n  /**\n   * Returns the final SQL string.\n   */\n  public toString(): string {\n    return this.items.map(item => this.itemToString(item)).join('');\n  }\n\n  /**\n   * Returns the internal layout data\n   */\n  public getLayoutItems(): LayoutItem[] {\n    return this.items;\n  }\n\n  private itemToString(item: LayoutItem): string {\n    switch (item) {\n      case WS.SPACE:\n        return ' ';\n      case WS.NEWLINE:\n      case WS.MANDATORY_NEWLINE:\n        return '\\n';\n      case WS.SINGLE_INDENT:\n        return this.indentation.getSingleIndent();\n      default:\n        return item;\n    }\n  }\n}\n\nconst isHorizontalWhitespace = (item: WS | string | undefined) =>\n  item === WS.SPACE || item === WS.SINGLE_INDENT;\n\nconst isRemovableWhitespace = (item: WS | string | undefined) =>\n  item === WS.SPACE || item === WS.SINGLE_INDENT || item === WS.NEWLINE;\n"],"mappings":"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"}